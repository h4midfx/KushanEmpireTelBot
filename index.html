
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ° Ø§Ù…Ù¾Ø±Ø§ØªÙˆØ±ÛŒ Ú©ÙˆØ´Ø§Ù†</title>
<link rel="icon" href="https://storyvibe.in/wp-content/uploads/2025/07/piclumen-1753972131169.png">
<style>
  body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background: #2B2B2B;
    color: #EAEAEA;
    direction: rtl;
  }
  h1 {
    text-align: center;
    padding: 20px 0;
  }
  #section-select, #menu {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 15px;
    gap: 10px;
  }
  button {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
    background: #555;
    color: #fff;
  }
  button:hover { background: #666; transform: translateY(-2px); }
  .btn-red { background: #CC0000; }
  input, select, textarea {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    border-radius: 6px;
    border: 1px solid #555;
    background: #3A3A3A;
    color: #fff;
  }
  #search-sort {
    max-width: 600px;
    margin: 10px auto;
    display: none;
    gap: 10px;
  }
  #inhalt {
    max-width: 900px;
    margin: auto;
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
    gap: 15px;
    padding-bottom: 30px;
  }
  .entry {
    background: #3A3A3A;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    transition: 0.3s;
  }
  .entry:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.7); }
  .entry img { max-width: 100%; border-radius: 5px; margin-top: 10px; }
  #admin-note-section, #notes-display {
    max-width: 600px;
    margin: 20px auto;
    padding: 15px;
    border-radius: 8px;
    background: #3A3A3A;
    box-shadow: 0 3px 6px rgba(0,0,0,0.5);
  }
</style>
</head>
<body>

<h1>ğŸ° Ø§Ù…Ù¾Ø±Ø§ØªÙˆØ±ÛŒ Ú©ÙˆØ´Ø§Ù†</h1>

<div id="section-select"></div>
<div id="menu"></div>

<div id="search-sort">
  <input type="text" id="search" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ø§Ø¬Ù…ØŒ Ù‡Ø¯Ù ÛŒØ§ Ø§ØªØ­Ø§Ø¯..." oninput="datenAnzeigen()">
  <select id="sortOrder" onchange="datenAnzeigen()">
    <option value="newest">Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ Ø§Ø¨ØªØ¯Ø§</option>
    <option value="oldest">Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ±ÛŒÙ†â€ŒÙ‡Ø§ Ø§Ø¨ØªØ¯Ø§</option>
  </select>
</div>

<div id="inhalt"></div>

<div id="admin-note-section" style="display:none;">
  <h3>Ù…Ø¯ÛŒØ±ÛŒØª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ø¯ÛŒØ±</h3>
  <label>Ù…ØªÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª:</label>
  <textarea id="note-text" rows="4"></textarea>
  <label>Ù†Ù…Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø§Ø² (ØªØ§Ø±ÛŒØ®/Ø²Ù…Ø§Ù†):</label>
  <input type="datetime-local" id="note-from">
  <label>Ù†Ù…Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ØªØ§ (ØªØ§Ø±ÛŒØ®/Ø²Ù…Ø§Ù†):</label>
  <input type="datetime-local" id="note-to">
  <button onclick="saveNote()">Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</button>
  <button onclick="hideAdminNoteSection()">Ø§Ù†ØµØ±Ø§Ù</button>
</div>

<div id="notes-display" style="display:none;"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase konfigurieren
const firebaseConfig = {
  apiKey: "AIzaSyDQvWVcwDQivNGysnvfm4fBBykNbYtnDZc",
  authDomain: "castel-game.firebaseapp.com",
  databaseURL: "https://castel-game-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "castel-game",
  storageBucket: "castel-game.appspot.com",
  messagingSenderId: "504558378124",
  appId: "1:504558378124:web:f494c563b755454770efa9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Variablen
let currentSection = null;
let isAdmin = false;
const ADMIN_PASSWORD = "admin123";
const inhalt = document.getElementById("inhalt");
const sectionSelectDiv = document.getElementById("section-select");
const menuDiv = document.getElementById("menu");
const searchSortDiv = document.getElementById("search-sort");
const searchInput = document.getElementById("search");
const sortSelect = document.getElementById("sortOrder");
const adminNoteSection = document.getElementById("admin-note-section");
const noteTextArea = document.getElementById("note-text");
const noteFromInput = document.getElementById("note-from");
const noteToInput = document.getElementById("note-to");
const notesDisplayDiv = document.getElementById("notes-display");

// Abteilungen
let sections = { kushan1: { password: "12345" }, kushan2: { password: null } };

// Render Abteilungen
function renderSectionButtons() {
  sectionSelectDiv.innerHTML = "";
  for(let sec in sections) {
    sectionSelectDiv.innerHTML += `<button onclick="selectSection('${sec}')">${sec.toUpperCase()}</button>`;
  }
}

// MenÃ¼ rendern
function renderMenuButtons() {
  let html = `
    <button onclick="neueDaten()">â• Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯</button>
    <button onclick="datenAnzeigen()">ğŸ“‚ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
    <button onclick="adminLogin()">ğŸ”‘ ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±</button>
    <button onclick="showAdminNoteSection()">ğŸ“ Ù…Ø¯ÛŒØ±ÛŒØª ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§</button>
  `;
  if(isAdmin) html += `<button onclick="addSection()">â• Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯</button>`;
  menuDiv.innerHTML = html;
}

// Abteilung auswÃ¤hlen
function selectSection(section) {
  const sec = sections[section];
  if(sec.password){
    const pw = prompt("Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø®Ø´ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");
    if(pw!==sec.password){ alert("âŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!"); return; }
  }
  currentSection = section;
  alert("âœ… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ " + section.toUpperCase());
  searchSortDiv.style.display = "flex";
  datenAnzeigen();
}

// Neue Abteilung hinzufÃ¼gen
function addSection() {
  if(!isAdmin){ alert("âŒ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±!"); return; }
  const name = prompt("Ù†Ø§Ù… Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯:");
  const pw = prompt("Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø®Ø´ (Ø®Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø¯ÙˆÙ† Ø±Ù…Ø²):");
  if(name){ sections[name] = {password: pw || null}; renderSectionButtons(); }
}

// Admin Login
function adminLogin() {
  const pw = prompt("Ø±Ù…Ø² Ù…Ø¯ÛŒØ±:");
  if(pw===ADMIN_PASSWORD){ isAdmin=true; alert("âœ… Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¯ÛŒØ± Ø¯Ø§Ø¯Ù‡ Ø´Ø¯!"); renderSectionButtons(); renderMenuButtons(); }
  else alert("âŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡!");
}

// Neue Daten hinzufÃ¼gen
function neueDaten() {
  if(!currentSection){ alert("Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø®Ø´ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."); return; }
  adminNoteSection.style.display="none"; notesDisplayDiv.style.display="none"; searchSortDiv.style.display="none";
  inhalt.innerHTML = `
    <h2>Ø­Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯</h2>
    <input type="text" id="attacker" placeholder="Ù†Ø§Ù… Ù…Ù‡Ø§Ø¬Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" />
    <input type="text" id="target" placeholder="Ù†Ø§Ù… Ù‡Ø¯Ù Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" />
    <input type="text" id="alliance" placeholder="Ù†Ø§Ù… Ø§ØªØ­Ø§Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" />
    <input type="file" id="bild" accept="image/*" />
    <button onclick="speichern()">Ø°Ø®ÛŒØ±Ù‡</button>
  `;
}

// Daten speichern
function speichern() {
  const attacker = document.getElementById("attacker").value.trim();
  const target = document.getElementById("target").value.trim();
  const alliance = document.getElementById("alliance").value.trim();
  const bild = document.getElementById("bild").files[0];
  if(!attacker||!target||!alliance||!bild){ alert("Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯ Ùˆ ØªØµÙˆÛŒØ± Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯!"); return; }

  const reader = new FileReader();
  reader.onload = function(){
    db.ref("castelDaten/" + currentSection).push({ attacker,target,alliance,bild: reader.result,zeit:new Date().toLocaleString() });
    alert("Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯!"); datenAnzeigen();
  };
  reader.readAsDataURL(bild);
}

// Daten anzeigen
function datenAnzeigen() {
  if(!currentSection){ inhalt.innerHTML=""; return; }
  adminNoteSection.style.display="none"; notesDisplayDiv.style.display="none"; searchSortDiv.style.display="flex";
  const searchValue = searchInput.value.toLowerCase();
  const sortOrder = sortSelect.value;
  inhalt.innerHTML=`<h2>ğŸ“‚ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ â€“ ${currentSection.toUpperCase()}</h2>`;

  db.ref("castelDaten/"+currentSection).once("value",snapshot=>{
    const daten = snapshot.val();
    if(!daten){ inhalt.innerHTML+="<p>Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</p>"; return; }

    const datenArray = Object.keys(daten).map(key=>({key,...daten[key]}));
    datenArray.sort((a,b)=> sortOrder==="newest"? new Date(b.zeit)-new Date(a.zeit): new Date(a.zeit)-new Date(b.zeit));

    let found=false;
    datenArray.forEach(e=>{
      if(e.attacker.toLowerCase().includes(searchValue)||e.target.toLowerCase().includes(searchValue)||e.alliance.toLowerCase().includes(searchValue)){
        found=true;
        let html = `<div class="entry">
          <strong>Ú†Ù‡ Ú©Ø³ÛŒ Ø­Ù…Ù„Ù‡ Ú©Ø±Ø¯ØŸ</strong>: ${e.attacker}<br>
          <strong>Ø¨Ù‡ Ú†Ù‡ Ú©Ø³ÛŒ Ø­Ù…Ù„Ù‡ Ø´Ø¯ØŸ</strong>: ${e.target}<br>
          <strong>Ú©Ø¯Ø§Ù… Ø§ØªØ­Ø§Ø¯</strong>: ${e.alliance}<br>
          <small>${e.zeit}</small><br>
          <img src="${e.bild}" alt="Attack Image"><br>`;
        if(isAdmin) html+=`<button class="btn-red" onclick="deleteEntry('${e.key}')">Ø­Ø°Ù</button>`;
        html+="</div>";
        inhalt.innerHTML+=html;
      }
    });
    if(!found) inhalt.innerHTML+="<p>Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</p>";
  });
}

// LÃ¶schen
function deleteEntry(key){
  if(!isAdmin){ alert("âŒ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±!"); return; }
  if(confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ")){ db.ref("castelDaten/"+currentSection+"/"+key).remove(); datenAnzeigen(); }
}

// Admin Notizen
function showAdminNoteSection(){
  if(!isAdmin){ alert("âŒ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±!"); return; }
  inhalt.innerHTML=""; searchSortDiv.style.display="none"; notesDisplayDiv.style.display="none"; adminNoteSection.style.display="block";
  db.ref("adminNotes").once("value",snapshot=>{
    const note=snapshot.val();
    if(note){ noteTextArea.value=note.text||""; noteFromInput.value=note.from||""; noteToInput.value=note.to||""; }
    else{ noteTextArea.value=""; noteFromInput.value=""; noteToInput.value=""; }
  });
}
function hideAdminNoteSection(){ adminNoteSection.style.display="none"; }
function saveNote(){
  const text=noteTextArea.value.trim(),from=noteFromInput.value,to=noteToInput.value;
  if(!text||!from||!to){alert("Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯!"); return;}
  db.ref("adminNotes").set({text,from,to}).then(()=>{alert("Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!"); adminNoteSection.style.display="none"; showNotesIfVisible(); })
  .catch(()=>{alert("Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡!");});
}
function showNotesIfVisible(){
  db.ref("adminNotes").once("value",snapshot=>{
    const note=snapshot.val();
    if(!note||!note.text||!note.from||!note.to){ notesDisplayDiv.style.display="none"; return;}
    const nowISO=new Date().toISOString();
    if(note.from<=nowISO && nowISO<=note.to){ notesDisplayDiv.style.display="block"; notesDisplayDiv.textContent=note.text;}
    else{ notesDisplayDiv.style.display="none";}
  });
}

// Start
window.onload=()=>{ renderSectionButtons(); renderMenuButtons(); showNotesIfVisible(); setInterval(showNotesIfVisible,60000); }
</script>
</body>
</html>
